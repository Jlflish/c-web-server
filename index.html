<!DOCTYPE html>
<html>
    <head>
        <title>My website</title>
        <meta charset = "UTF-8">
    </head>
    <body>
        <h1>chatroom</h1>
        <p>c++ chatroom implemented by myself</p>
        <div id="messages"></div>
        <br/>
        <input type="text" id="user" placeholder="your username"/>
        <input type="text" id="content" placeholder="type your message"/>
        <button id="send">send message</button>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>
            $(document).ready(function() {
                $("#send").click(function() {
                    var user = $("#user").val();
                    var content = $("#content").val();
                    $.post("/send", JSON.stringify({user, content}), function(data) {              
                        console.log("/send get:", data);
                        $("#content").val('');
                    });
                });
                function poll() {
                    $.post("/recv", {}, function(data) {
                        console.log("/recv get:", data);
                        var messages = JSON.parse(data);
                        $("#messages").html('');
                        for (var i = 0; i < messages.length; i++) {
                            var msg = messages[i];
                            $("#messages").append("<p>" + msg.user + ": " + msg.content + "</p>");
                        }
                    });
                };
                setInterval(poll, 1000);
            });
        </script>
    </body>
</html>